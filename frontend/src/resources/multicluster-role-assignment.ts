/* Copyright Contributors to the Open Cluster Management project */
import { Subject } from './kubernetes-client'
import { Metadata } from './metadata'
import { IResource, IResourceDefinition } from './resource'
import { UserKind } from './rbac'
import { Cluster } from './utils'

export const MulticlusterRoleAssignmentApiVersion = 'rbac.open-cluster-management.io/v1beta1'
export type MulticlusterRoleAssignmentApiVersionType = 'rbac.open-cluster-management.io/v1beta1'

export const MulticlusterRoleAssignmentKind = 'MulticlusterRoleAssignment'
export type MulticlusterRoleAssignmentKindType = 'MulticlusterRoleAssignment'

export const MulticlusterRoleAssignmentNamespace = 'open-cluster-management-global-set'

export const MulticlusterRoleAssignmentDefinition: IResourceDefinition = {
  apiVersion: MulticlusterRoleAssignmentApiVersion,
  kind: MulticlusterRoleAssignmentKind,
}

export interface PlacementRef {
  name: string
  namespace: string
}

export interface ClusterSelection {
  type: 'placements'
  placements: PlacementRef[]
}

export interface RoleAssignment {
  name: string
  clusterRole: string
  targetNamespaces?: string[]
  clusterSelection: ClusterSelection
  // to be filled by the client
  clusters?: Cluster[]
}

export interface RoleAssignmentStatus {
  name: string
  status: 'Active' | 'Error' | 'Pending'
  reason?: string
  message?: string
  createdAt?: string
}

export interface Condition {
  lastTransitionTime: string
  message: string
  observedGeneration: number
  reason: string
  status: 'True' | 'False' | 'Unknown'
  type: string
}

export interface MulticlusterRoleAssignment extends IResource {
  apiVersion: MulticlusterRoleAssignmentApiVersionType
  kind: MulticlusterRoleAssignmentKindType
  metadata: Metadata
  spec: {
    subject: Subject
    roleAssignments: RoleAssignment[]
  }
  status?: {
    conditions?: Condition[]
    roleAssignments?: RoleAssignmentStatus[]
  }
}

export const emptyMulticlusterRoleAssignment: MulticlusterRoleAssignment = {
  apiVersion: MulticlusterRoleAssignmentApiVersion,
  kind: MulticlusterRoleAssignmentKind,
  metadata: {},
  spec: {
    subject: {
      kind: UserKind,
      name: '',
    },
    roleAssignments: [],
  },
}
